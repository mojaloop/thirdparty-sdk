<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="5846px" preserveAspectRatio="none" style="width:5317px;height:5846px;background:#FFFFFF;" version="1.1" viewBox="0 0 5317 5846" width="5317px" zoomAndPan="magnify"><defs><filter height="300%" id="f1au4b3xzil1e4" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="147" x="2581.5" y="28.708">PISP Transaction</text><rect fill="#DDDDDD" height="5799.9063" style="stroke:#A80036;stroke-width:1.0;" width="1096.5" x="481.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="180" x="939.75" y="53.02">PISP tp-scheme-adapter</text><rect fill="#DDDDDD" height="5799.9063" style="stroke:#A80036;stroke-width:1.0;" width="467.5" x="1580" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="191" x="1718.25" y="53.02">PISP sdk-scheme-adapter</text><rect fill="#DDDDDD" height="5799.9063" style="stroke:#A80036;stroke-width:1.0;" width="606.5" x="2049.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="2319.25" y="53.02">Mojaloop</text><rect fill="#DDDDDD" height="5799.9063" style="stroke:#A80036;stroke-width:1.0;" width="275" x="3026.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="197" x="3065.5" y="53.02">DFSP sdk-scheme-adapter</text><rect fill="#DDDDDD" height="5799.9063" style="stroke:#A80036;stroke-width:1.0;" width="1169.5" x="3513" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="186" x="4004.75" y="53.02">DFSP tp-scheme-adapter</text><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="296.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="69.5" y="308.7109"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="2140.8281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="69.5" y="1038.6328"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="2385.5625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="69.5" y="3399"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="296.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="547.5" y="308.7109"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="2140.8281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="547.5" y="1038.6328"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="2385.5625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="547.5" y="3399"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="237.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="337.8438"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="1067.7656"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="68.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="2039.8828"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="125.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="3024.9297"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="3428.1328"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="62.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="4653.0469"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="62.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="5693.1641"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="126.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1507.5" y="1981.6172"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="88.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1507.5" y="2966.6641"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="97.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1507.5" y="4555.6484"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1507.5" y="5634.8984"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1646" y="442.2422"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="159.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2080" y="1172.1641"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2080" y="1923.3516"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="214.0625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2080" y="2781.7344"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="120.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2080" y="3532.5313"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2080" y="3906.9922"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2080" y="4146.9219"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="126.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2080" y="4458.25"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2080" y="4854.8438"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="159.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2080" y="5504.3672"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="1828.3047" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2597" y="3965.2578"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3225.5" y="2509.6719"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3225.5" y="5289.5703"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="97.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3573.5" y="1302.6953"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="2169.6328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3573.5" y="3623.9297"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="1787.3672" style="stroke:#FFFFFF;stroke-width:1.0;" width="10" x="3880.5" y="1400.0938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3880.5" x2="3880.5" y1="1400.0938" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3890.5" x2="3890.5" y1="1400.0938" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3880.5" x2="3890.5" y1="1400.0938" y2="1400.0938"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="2292.4297" style="stroke:#FFFFFF;stroke-width:1.0;" width="10" x="3880.5" y="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3880.5" x2="3880.5" y1="3241.0703" y2="5533.5"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3890.5" x2="3890.5" y1="3241.0703" y2="5533.5"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3880.5" x2="3890.5" y1="5533.5" y2="5533.5"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="74" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="74" x2="74" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="74" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="74" x2="74" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="74" y1="3241.0703" y2="5802.5625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="552.5" x2="552.5" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="552.5" x2="552.5" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="552.5" x2="552.5" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="552.5" x2="552.5" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="552.5" x2="552.5" y1="3241.0703" y2="5802.5625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="900" x2="900" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="900" x2="900" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="900" x2="900" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="900" x2="900" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="900" x2="900" y1="3241.0703" y2="5802.5625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1512" x2="1512" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1512" x2="1512" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1512" x2="1512" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1512" x2="1512" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1512" x2="1512" y1="3241.0703" y2="5802.5625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1651" x2="1651" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1651" x2="1651" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1651" x2="1651" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1651" x2="1651" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1651" x2="1651" y1="3241.0703" y2="5802.5625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1981.5" x2="1981.5" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1981.5" x2="1981.5" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1981.5" x2="1981.5" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1981.5" x2="1981.5" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1981.5" x2="1981.5" y1="3241.0703" y2="5802.5625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2084.5" x2="2084.5" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="2084.5" x2="2084.5" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2084.5" x2="2084.5" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="2084.5" x2="2084.5" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2084.5" x2="2084.5" y1="3241.0703" y2="5802.5625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2602" x2="2602" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="2602" x2="2602" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2602" x2="2602" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="2602" x2="2602" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2602" x2="2602" y1="3241.0703" y2="5802.5625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3091.5" x2="3091.5" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3091.5" x2="3091.5" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3091.5" x2="3091.5" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3091.5" x2="3091.5" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3091.5" x2="3091.5" y1="3241.0703" y2="5802.5625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3230.5" x2="3230.5" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3230.5" x2="3230.5" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3230.5" x2="3230.5" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3230.5" x2="3230.5" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3230.5" x2="3230.5" y1="3241.0703" y2="5802.5625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3578" x2="3578" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3578" x2="3578" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3578" x2="3578" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3578" x2="3578" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3578" x2="3578" y1="3241.0703" y2="5802.5625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3885.5" x2="3885.5" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3885.5" x2="3885.5" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3885.5" x2="3885.5" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3885.5" x2="3885.5" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3885.5" x2="3885.5" y1="3241.0703" y2="5802.5625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4611.5" x2="4611.5" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="4611.5" x2="4611.5" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4611.5" x2="4611.5" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="4611.5" x2="4611.5" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4611.5" x2="4611.5" y1="3241.0703" y2="5802.5625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4723.5" x2="4723.5" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="4723.5" x2="4723.5" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4723.5" x2="4723.5" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="4723.5" x2="4723.5" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4723.5" x2="4723.5" y1="3241.0703" y2="5802.5625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="5276" x2="5276" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="5276" x2="5276" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="5276" x2="5276" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="5276" x2="5276" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="5276" x2="5276" y1="3241.0703" y2="5802.5625"/><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="18" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="25" y="80.0811">PISP Backend</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="18" y="5801.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="25" y="5821.5576">PISP Backend</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="485.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="492.5" y="80.0811">outbound-server</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="485.5" y="5801.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="492.5" y="5821.5576">outbound-server</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="167" x="815" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="153" x="822" y="80.0811">PISPTransactionModel</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="167" x="815" y="5801.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="153" x="822" y="5821.5576">PISPTransactionModel</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1451" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1458" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1451" y="5801.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1458" y="5821.5576">inbound-server</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="1584" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="1591" y="80.0811">outbound-server</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="1584" y="5801.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="1591" y="5821.5576">outbound-server</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1920.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1927.5" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1920.5" y="5801.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1927.5" y="5821.5576">inbound-server</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="2053.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="2060.5" y="80.0811">Switch</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="2053.5" y="5801.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="2060.5" y="5821.5576">Switch</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="96" x="2552" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="2559" y="80.0811">AuthService</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="96" x="2552" y="5801.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="2559" y="5821.5576">AuthService</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="3030.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="3037.5" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="3030.5" y="5801.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="3037.5" y="5821.5576">inbound-server</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="3163.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="3170.5" y="80.0811">outbound-server</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="3163.5" y="5801.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="3170.5" y="5821.5576">outbound-server</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="3517" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="3524" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="3517" y="5801.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="3524" y="5821.5576">inbound-server</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="174" x="3796.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160" x="3803.5" y="80.0811">DFSPTransactionModel</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="174" x="3796.5" y="5801.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160" x="3803.5" y="5821.5576">DFSPTransactionModel</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="4544.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="4551.5" y="80.0811">outbound-server</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="4544.5" y="5801.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="4551.5" y="5821.5576">outbound-server</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="67" x="4688.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="4695.5" y="80.0811">activate</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="67" x="4688.5" y="5801.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="4695.5" y="5821.5576">activate</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="54" x="5247" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="5254" y="80.0811">Swich</text><rect fill="#FEFECE" filter="url(#f1au4b3xzil1e4)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="54" x="5247" y="5801.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="5254" y="5821.5576">Swich</text><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="296.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="69.5" y="308.7109"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="2140.8281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="69.5" y="1038.6328"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="2385.5625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="69.5" y="3399"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="296.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="547.5" y="308.7109"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="2140.8281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="547.5" y="1038.6328"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="2385.5625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="547.5" y="3399"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="237.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="337.8438"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="1067.7656"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="68.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="2039.8828"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="125.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="3024.9297"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="3428.1328"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="62.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="4653.0469"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="62.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="5693.1641"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="126.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1507.5" y="1981.6172"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="88.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1507.5" y="2966.6641"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="97.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1507.5" y="4555.6484"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1507.5" y="5634.8984"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1646" y="442.2422"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="159.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2080" y="1172.1641"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2080" y="1923.3516"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="214.0625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2080" y="2781.7344"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="120.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2080" y="3532.5313"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2080" y="3906.9922"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2080" y="4146.9219"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="126.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2080" y="4458.25"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2080" y="4854.8438"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="159.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2080" y="5504.3672"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="1828.3047" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2597" y="3965.2578"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3225.5" y="2509.6719"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3225.5" y="5289.5703"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="97.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3573.5" y="1302.6953"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="2169.6328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3573.5" y="3623.9297"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="1787.3672" style="stroke:#FFFFFF;stroke-width:1.0;" width="10" x="3880.5" y="1400.0938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3880.5" x2="3880.5" y1="1400.0938" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3890.5" x2="3890.5" y1="1400.0938" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3880.5" x2="3890.5" y1="1400.0938" y2="1400.0938"/><rect fill="#FFFFFF" filter="url(#f1au4b3xzil1e4)" height="2292.4297" style="stroke:#FFFFFF;stroke-width:1.0;" width="10" x="3880.5" y="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3880.5" x2="3880.5" y1="3241.0703" y2="5533.5"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3890.5" x2="3890.5" y1="3241.0703" y2="5533.5"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3880.5" x2="3890.5" y1="5533.5" y2="5533.5"/><rect fill="#EEEEEE" filter="url(#f1au4b3xzil1e4)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="5310" x="0" y="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="5310" y1="125.9492" y2="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="5310" y1="128.9492" y2="128.9492"/><rect fill="#EEEEEE" filter="url(#f1au4b3xzil1e4)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="117" x="2596.5" y="115.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="2602.5" y="131.4497">Party Lookup</text><rect fill="#ADD8E6" filter="url(#f1au4b3xzil1e4)" height="129" style="stroke:#A80036;stroke-width:1.0;" width="448" x="79" y="153.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="261" x="83" y="169.5825">POST /thirdpartyTransaction/partyLookup</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="83" y="184.7153">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="432" x="91" y="199.8481">transactionRequestId: "b51ec534-ee48-4575-b6a9-ead2955b8069",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="91" y="214.981">payee: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="99" y="230.1138">partyIdType: "MSISDN",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="99" y="245.2466">partyIdentifier: "+123456789"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="91" y="260.3794">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="83" y="275.5122">}</text><polygon fill="#A80036" points="535.5,304.7109,545.5,308.7109,535.5,312.7109,539.5,308.7109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="79.5" x2="541.5" y1="308.7109" y2="308.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="86.5" y="303.645">LOOK-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="261" x="144.5" y="303.645">POST /thirdpartyTransaction/partyLookup</text><polygon fill="#A80036" points="883.5,333.8438,893.5,337.8438,883.5,341.8438,887.5,337.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="557.5" x2="889.5" y1="337.8438" y2="337.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="564.5" y="332.7778">LOOK-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="622.5" y="332.7778">partyLookup()</text><rect fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="177" x="910" y="350.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="914" y="366.9106">state: requestPartyLookup</text><line style="stroke:#A80036;stroke-width:1.0;" x1="905.5" x2="947.5" y1="400.1094" y2="400.1094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="947.5" x2="947.5" y1="400.1094" y2="413.1094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="906.5" x2="947.5" y1="413.1094" y2="413.1094"/><polygon fill="#A80036" points="916.5,409.1094,906.5,413.1094,916.5,417.1094,912.5,413.1094" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="912.5" y="395.0435">LOOK-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="256" x="970.5" y="395.0435">SDKRequests.requestPartiesInformation</text><polygon fill="#A80036" points="1634,438.2422,1644,442.2422,1634,446.2422,1638,442.2422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="905.5" x2="1640" y1="442.2422" y2="442.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="912.5" y="437.1763">LOOK-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="970.5" y="437.1763">SYNC GET /parties/{type}/{id}</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1656" x2="1698" y1="471.375" y2="471.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1698" x2="1698" y1="471.375" y2="484.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1657" x2="1698" y1="484.375" y2="484.375"/><polygon fill="#A80036" points="1667,480.375,1657,484.375,1667,488.375,1663,484.375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="1663" y="466.3091">LOOK-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="1721" y="466.3091">retrieve PartiesInformation from Switch</text><polygon fill="#A80036" points="916.5,509.5078,906.5,513.5078,916.5,517.5078,912.5,513.5078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="910.5" x2="1650" y1="513.5078" y2="513.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="922.5" y="508.4419">LOOK-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="980.5" y="508.4419">200 PartyInformation</text><rect fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="145" x="910" y="526.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="914" y="542.5747">state: payeeResolved</text><polygon fill="#A80036" points="568.5,571.7734,558.5,575.7734,568.5,579.7734,564.5,575.7734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="562.5" x2="899.5" y1="575.7734" y2="575.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="574.5" y="570.7075">LOOK-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="632.5" y="570.7075">partyInformation</text><polygon fill="#A80036" points="85.5,600.9063,75.5,604.9063,85.5,608.9063,81.5,604.9063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79.5" x2="551.5" y1="604.9063" y2="604.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="91.5" y="599.8403">LOOK-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="149.5" y="599.8403">200 OK PartyInformation</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="379" x="2485.75" y="637.1167">User checks the party name, and confirms transaction to continue</text><rect fill="#EEEEEE" filter="url(#f1au4b3xzil1e4)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="5310" x="0" y="674.2773"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="5310" y1="674.2773" y2="674.2773"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="5310" y1="677.2773" y2="677.2773"/><rect fill="#EEEEEE" filter="url(#f1au4b3xzil1e4)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="156" x="2577" y="663.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="137" x="2583" y="679.7778">Initate Transaction</text><rect fill="#ADD8E6" filter="url(#f1au4b3xzil1e4)" height="310" style="stroke:#A80036;stroke-width:1.0;" width="395" x="79" y="701.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="387" x="83" y="717.9106">POST /thirdpartyTransactions/{transactionRequestId}/initiate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="83" y="733.0435">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="91" y="748.1763">amount: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="99" y="763.3091">amount: "20.00",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="99" y="778.4419">currency: "USD"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="91" y="793.5747">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="91" y="808.7075">"amountType": "SEND",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="91" y="823.8403">"payee": {....},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="91" y="838.9731">"payer": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="99" y="854.106">"partyIdType": "THIRD_PARTY_LINK",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="99" y="869.2388">"partyIdentifier": "qwerty-56789",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="99" y="884.3716">"fspId": "dfspa"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="91" y="899.5044">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="91" y="914.6372">"transactionType": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="99" y="929.77">"scenario": "TRANSFER",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="99" y="944.9028">"initiator": 'PAYER",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="99" y="960.0356">"initiatorType": "CONSUMER"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="91" y="975.1685">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="287" x="91" y="990.3013">expiration: "2021-03-08T08:08:08.699-04:00"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="83" y="1005.4341">}</text><polygon fill="#A80036" points="535.5,1034.6328,545.5,1038.6328,535.5,1042.6328,539.5,1038.6328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="79.5" x2="541.5" y1="1038.6328" y2="1038.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="86.5" y="1033.5669">INIT-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="387" x="131.5" y="1033.5669">POST /thirdpartyTransactions/{transactionRequestId}/initiate</text><polygon fill="#A80036" points="883.5,1063.7656,893.5,1067.7656,883.5,1071.7656,887.5,1067.7656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="557.5" x2="889.5" y1="1067.7656" y2="1067.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="564.5" y="1062.6997">INIT-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="609.5" y="1062.6997">initiate()</text><rect fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="236" x="910" y="1080.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="914" y="1096.8325">state: requestThirdpartyTransaction</text><line style="stroke:#A80036;stroke-width:1.0;" x1="905.5" x2="947.5" y1="1130.0313" y2="1130.0313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="947.5" x2="947.5" y1="1130.0313" y2="1143.0313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="906.5" x2="947.5" y1="1143.0313" y2="1143.0313"/><polygon fill="#A80036" points="916.5,1139.0313,906.5,1143.0313,916.5,1147.0313,912.5,1143.0313" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="912.5" y="1124.9653">INIT-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="287" x="957.5" y="1124.9653">SDKRequests.requestThirdpartyTransaction()</text><polygon fill="#A80036" points="2068,1168.1641,2078,1172.1641,2068,1176.1641,2072,1172.1641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="905.5" x2="2074" y1="1172.1641" y2="1172.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="912.5" y="1167.0981">INIT-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246" x="957.5" y="1167.0981">POST /thirdpartyRequests/transactions</text><polygon fill="#A80036" points="911.5,1197.2969,901.5,1201.2969,911.5,1205.2969,907.5,1201.2969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="905.5" x2="2079" y1="1201.2969" y2="1201.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="917.5" y="1196.231">INIT-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="962.5" y="1196.231">202 Accepted</text><rect fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="228" x="905" y="1214.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="909" y="1230.3638">state: pendingTransactionInitiation</text><path d="M3441,1247.4297 L3441,1272.4297 L3711,1272.4297 L3711,1257.4297 L3701,1247.4297 L3441,1247.4297 " fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3701,1247.4297 L3701,1257.4297 L3711,1257.4297 L3701,1247.4297 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="3447" y="1264.4966">DFSP handles PISP transaction request</text><polygon fill="#A80036" points="3561.5,1298.6953,3571.5,1302.6953,3561.5,1306.6953,3565.5,1302.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2090" x2="3567.5" y1="1302.6953" y2="1302.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="2097" y="1297.6294">INIT-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246" x="2142" y="1297.6294">POST /thirdpartyRequests/transactions</text><polygon fill="#A80036" points="2096,1327.8281,2086,1331.8281,2096,1335.8281,2092,1331.8281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2090" x2="3572.5" y1="1331.8281" y2="1331.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="2102" y="1326.7622">INIT-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2147" y="1326.7622">202 Accepted</text><path d="M3721,1344.8281 L3721,1369.8281 L4045,1369.8281 L4045,1354.8281 L4035,1344.8281 L3721,1344.8281 " fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4035,1344.8281 L4035,1354.8281 L4045,1354.8281 L4035,1344.8281 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="303" x="3727" y="1361.895">DFSP starts workflow for DFSPTransactionModel</text><polygon fill="#A80036" points="3868.5,1396.0938,3878.5,1400.0938,3868.5,1404.0938,3872.5,1400.0938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3578.5" x2="3874.5" y1="1400.0938" y2="1400.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="3585.5" y="1395.0278">INIT-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="3630.5" y="1395.0278">transactionRequestReceived()</text><rect fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="281" x="3895" y="1413.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="3899" y="1429.1606">state: transactionRequestReceived</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="183" x="3899" y="1444.2935">transactionRequestState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10" x="4086" y="1444.2935">is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="72" x="4100" y="1444.2935">RECEIVED</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3890.5" x2="3932.5" y1="1477.4922" y2="1477.4922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3932.5" x2="3932.5" y1="1477.4922" y2="1490.4922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3891.5" x2="3932.5" y1="1490.4922" y2="1490.4922"/><polygon fill="#A80036" points="3901.5,1486.4922,3891.5,1490.4922,3901.5,1494.4922,3897.5,1490.4922" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="3897.5" y="1472.4263">INIT-9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="366" x="3942.5" y="1472.4263">persist transactionRequestState for transactionRequestId</text><path d="M3643,1503.4922 L3643,1528.4922 L4124,1528.4922 L4124,1513.4922 L4114,1503.4922 L3643,1503.4922 " fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4114,1503.4922 L4114,1513.4922 L4124,1513.4922 L4114,1503.4922 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="460" x="3649" y="1520.5591">DFSP asks its backend to verify consent for payer via THIRD_PARTY_LINK</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3890.5" x2="3932.5" y1="1558.7578" y2="1558.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3932.5" x2="3932.5" y1="1558.7578" y2="1571.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3891.5" x2="3932.5" y1="1571.7578" y2="1571.7578"/><polygon fill="#A80036" points="3901.5,1567.7578,3891.5,1571.7578,3901.5,1575.7578,3897.5,1571.7578" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="3897.5" y="1553.6919">INIT-10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="624" x="3951.5" y="1553.6919">DFSPBackendRequests.validateThirdpartyTransactionRequestAndGetContext(transactionRequest)</text><path d="M3784,1584.7578 L3784,1609.7578 L3982,1609.7578 L3982,1594.7578 L3972,1584.7578 L3784,1584.7578 " fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3972,1584.7578 L3972,1594.7578 L3982,1594.7578 L3972,1584.7578 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="3790" y="1601.8247">DFSP is happy with Consent</text><rect fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="141" x="3895" y="1623.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="3899" y="1639.9575">state: consentIsValid</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3890.5" x2="3932.5" y1="1673.1563" y2="1673.1563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3932.5" x2="3932.5" y1="1673.1563" y2="1686.1563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3891.5" x2="3932.5" y1="1686.1563" y2="1686.1563"/><polygon fill="#A80036" points="3901.5,1682.1563,3891.5,1686.1563,3901.5,1690.1563,3897.5,1686.1563" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="3897.5" y="1668.0903">INIT-11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="3951.5" y="1668.0903">so generate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="97" x="4032.5" y="1668.0903">transactionId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="4129.5" y="1668.0903">: '1234-1234-1234-1234'</text><path d="M3686,1699.1563 L3686,1724.1563 L4081,1724.1563 L4081,1709.1563 L4071,1699.1563 L3686,1699.1563 " fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4071,1699.1563 L4071,1709.1563 L4081,1709.1563 L4071,1699.1563 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="3692" y="1716.2231">DFSP informs PISP that</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="97" x="3844" y="1716.2231">transactionId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="3945" y="1716.2231">has been allocated</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3890.5" x2="3932.5" y1="1754.4219" y2="1754.4219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3932.5" x2="3932.5" y1="1754.4219" y2="1767.4219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3891.5" x2="3932.5" y1="1767.4219" y2="1767.4219"/><polygon fill="#A80036" points="3901.5,1763.4219,3891.5,1767.4219,3901.5,1771.4219,3897.5,1767.4219" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="3897.5" y="1749.356">INIT-12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="648" x="3951.5" y="1749.356">SDKRequests.notifyThirdpartyAboutTransactionRequestState(transactionId, transactionRequestState)</text><rect fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="400" x="3895" y="1780.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="392" x="3899" y="1796.4888">state: pendingNotifyThirdpartyAboutTransactionRequestState</text><rect fill="#ADD8E6" filter="url(#f1au4b3xzil1e4)" height="83" style="stroke:#A80036;stroke-width:1.0;" width="393" x="3895" y="1813.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="385" x="3899" y="1829.6216">PUT /thirdpartyRequests/transaction/{transactionRequestId}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3899" y="1844.7544">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244" x="3907" y="1859.8872">transactionId: '1234-1234-1234-1234',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236" x="3907" y="1875.02">transactionRequestState: 'RECEIVED'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3899" y="1890.1528">}</text><polygon fill="#A80036" points="2101,1919.3516,2091,1923.3516,2101,1927.3516,2097,1923.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2095" x2="3879.5" y1="1923.3516" y2="1923.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="2107" y="1918.2856">INIT-13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="385" x="2161" y="1918.2856">PUT /thirdpartyRequests/transaction/{transactionRequestId}</text><polygon fill="#A80036" points="3868.5,1948.4844,3878.5,1952.4844,3868.5,1956.4844,3872.5,1952.4844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2090" x2="3874.5" y1="1952.4844" y2="1952.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="2097" y="1947.4185">INIT-14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2151" y="1947.4185">202 Accepted</text><polygon fill="#A80036" points="1528.5,1977.6172,1518.5,1981.6172,1528.5,1985.6172,1524.5,1981.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1522.5" x2="2079" y1="1981.6172" y2="1981.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="1534.5" y="1976.5513">INIT-15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="385" x="1588.5" y="1976.5513">PUT /thirdpartyRequests/transaction/{transactionRequestId}</text><polygon fill="#A80036" points="2073,2006.75,2083,2010.75,2073,2014.75,2077,2010.75" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1517.5" x2="2079" y1="2010.75" y2="2010.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="1524.5" y="2005.6841">INIT-16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="1578.5" y="2005.6841">202 accepted</text><polygon fill="#A80036" points="916.5,2035.8828,906.5,2039.8828,916.5,2043.8828,912.5,2039.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="910.5" x2="1506.5" y1="2039.8828" y2="2039.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="922.5" y="2034.8169">INIT-17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="976.5" y="2034.8169">transactionRequestReceived()</text><rect fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="230" x="910" y="2052.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="914" y="2068.9497">state: transactionRequestReceived</text><line style="stroke:#A80036;stroke-width:1.0;" x1="905.5" x2="947.5" y1="2107.1484" y2="2107.1484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="947.5" x2="947.5" y1="2107.1484" y2="2120.1484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="900.5" x2="947.5" y1="2120.1484" y2="2120.1484"/><polygon fill="#A80036" points="910.5,2116.1484,900.5,2120.1484,910.5,2124.1484,906.5,2120.1484" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="912.5" y="2102.0825">INIT-18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="966.5" y="2102.0825">store received</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="97" x="1061.5" y="2102.0825">transactionId</text><path d="M644,2128.1484 L644,2364.1484 L1153,2364.1484 L1153,2138.1484 L1143,2128.1484 L644,2128.1484 " fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1143,2128.1484 L1143,2138.1484 L1153,2138.1484 L1143,2128.1484 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="650" y="2145.2153">There could be a race condition (time based hazard)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174" x="650" y="2160.3481">between two incoming calls</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="654" y="2175.481"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="306" x="650" y="2190.6138">PUT /thirdpartyReqeusts/transaction/{id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="24" x="650" y="2205.7466">and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="301" x="650" y="2220.8794">POST /thirdpartyRequests/authorizations</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="654" y="2236.0122"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="366" x="650" y="2251.145">so we are mitigating it by alternative two-step transitions:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="654" y="2266.2778"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237" x="650" y="2281.4106">pendingTransactionInitiation (START):</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="480" x="658" y="2296.5435">-&gt; (CASE-1) transactionRequestReceived -&gt; authorizationRequestReceived</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="480" x="658" y="2311.6763">-&gt; (CASE-2) authorizationRequestReceived -&gt; transactionRequestReceived</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241" x="650" y="2326.8091">-&gt; transactionInitiationSuccess (END)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="654" y="2341.9419"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="650" y="2357.0747">CASE-1 is visualised here</text><path d="M3770,2379.1406 L3770,2404.1406 L3997,2404.1406 L3997,2389.1406 L3987,2379.1406 L3770,2379.1406 " fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3987,2379.1406 L3987,2389.1406 L3997,2389.1406 L3987,2379.1406 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="3776" y="2396.2075">DFSP requires QuoteInformation</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3890.5" x2="3932.5" y1="2434.4063" y2="2434.4063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3932.5" x2="3932.5" y1="2434.4063" y2="2447.4063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3891.5" x2="3932.5" y1="2447.4063" y2="2447.4063"/><polygon fill="#A80036" points="3901.5,2443.4063,3891.5,2447.4063,3901.5,2451.4063,3897.5,2447.4063" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="3897.5" y="2429.3403">INIT-19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="3951.5" y="2429.3403">SDKRequests.requestQuote()</text><rect fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="191" x="3895" y="2460.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="3899" y="2476.4731">state: pendingRequestQuote</text><polygon fill="#A80036" points="3246.5,2505.6719,3236.5,2509.6719,3246.5,2513.6719,3242.5,2509.6719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3240.5" x2="3879.5" y1="2509.6719" y2="2509.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="3252.5" y="2504.606">INIT-20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="3306.5" y="2504.606">SYNC POST /quotes</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3235.5" x2="3277.5" y1="2538.8047" y2="2538.8047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3277.5" x2="3277.5" y1="2538.8047" y2="2551.8047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3236.5" x2="3277.5" y1="2551.8047" y2="2551.8047"/><polygon fill="#A80036" points="3246.5,2547.8047,3236.5,2551.8047,3246.5,2555.8047,3242.5,2551.8047" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="3242.5" y="2533.7388">INIT-21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244" x="3296.5" y="2533.7388">retrieve QuoteInformation from Switch</text><polygon fill="#A80036" points="3868.5,2576.9375,3878.5,2580.9375,3868.5,2584.9375,3872.5,2580.9375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3230.5" x2="3874.5" y1="2580.9375" y2="2580.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="3237.5" y="2575.8716">INIT-22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="3291.5" y="2575.8716">200 QuoteInformation</text><path d="M3630,2593.9375 L3630,2618.9375 L4137,2618.9375 L4137,2603.9375 L4127,2593.9375 L3630,2593.9375 " fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4127,2593.9375 L4127,2603.9375 L4137,2603.9375 L4127,2593.9375 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="486" x="3636" y="2611.0044">DFSP has the QuoteInformation, they can now ask the PISP for authorization</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3890.5" x2="3932.5" y1="2649.2031" y2="2649.2031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3932.5" x2="3932.5" y1="2649.2031" y2="2662.2031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3891.5" x2="3932.5" y1="2662.2031" y2="2662.2031"/><polygon fill="#A80036" points="3901.5,2658.2031,3891.5,2662.2031,3901.5,2666.2031,3897.5,2662.2031" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="3897.5" y="2644.1372">INIT-23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234" x="3951.5" y="2644.1372">SDKRequests.requestAuthorization()</text><rect fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="276" x="3895" y="2675.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229" x="3899" y="2691.27">state: pendingRequestAuthorization</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="183" x="3899" y="2706.4028">transactionRequestState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10" x="4086" y="2706.4028">is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="4100" y="2706.4028">PENDING</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3890.5" x2="3932.5" y1="2739.6016" y2="2739.6016"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3932.5" x2="3932.5" y1="2739.6016" y2="2752.6016"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3891.5" x2="3932.5" y1="2752.6016" y2="2752.6016"/><polygon fill="#A80036" points="3901.5,2748.6016,3891.5,2752.6016,3901.5,2756.6016,3897.5,2752.6016" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="3897.5" y="2734.5356">INIT-24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="366" x="3951.5" y="2734.5356">persist transactionRequestState for transactionRequestId</text><polygon fill="#A80036" points="2101,2777.7344,2091,2781.7344,2101,2785.7344,2097,2781.7344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2095" x2="3879.5" y1="2781.7344" y2="2781.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="2107" y="2776.6685">INIT-25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="258" x="2161" y="2776.6685">POST /thirdpartyRequests/authorizations</text><path d="M3670,2794.7344 L3670,2864.7344 L4096,2864.7344 L4096,2804.7344 L4086,2794.7344 L3670,2794.7344 " fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4086,2794.7344 L4086,2804.7344 L4096,2804.7344 L4086,2794.7344 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="3676" y="2811.8013">From now DFSPTransactionModel is blocked</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="405" x="3676" y="2826.9341">on synchronous call to POST /thirdpartyRequests/authorizations</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="3676" y="2842.0669">until PISP initiate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="152" x="3786" y="2842.0669">Approve Transaction</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="3942" y="2842.0669">phase.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="320" x="3676" y="2857.1997">Here timeout scenario should be handled properly</text><polygon fill="#A80036" points="3868.5,2891.3984,3878.5,2895.3984,3868.5,2899.3984,3872.5,2895.3984" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2090" x2="3874.5" y1="2895.3984" y2="2895.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="2097" y="2890.3325">INIT-26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2151" y="2890.3325">202 Accepted</text><line style="stroke:#A80036;stroke-width:1.0;" x1="4724" x2="4766" y1="2929.5313" y2="2929.5313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4766" x2="4766" y1="2929.5313" y2="2942.5313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4719" x2="4766" y1="2942.5313" y2="2942.5313"/><polygon fill="#A80036" points="4729,2938.5313,4719,2942.5313,4729,2946.5313,4725,2942.5313" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="4731" y="2924.4653">INIT-27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="484" x="4785" y="2924.4653">waiting on PUT /thirdpartyRequests/authorizations/{authorizationRequestId}</text><polygon fill="#A80036" points="1528.5,2962.6641,1518.5,2966.6641,1528.5,2970.6641,1524.5,2966.6641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1522.5" x2="2079" y1="2966.6641" y2="2966.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="1534.5" y="2961.5981">INIT-28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="258" x="1588.5" y="2961.5981">POST /thirdpartyRequests/authorizations</text><polygon fill="#A80036" points="2073,2991.7969,2083,2995.7969,2073,2999.7969,2077,2995.7969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1517.5" x2="2079" y1="2995.7969" y2="2995.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="1524.5" y="2990.731">INIT-29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1578.5" y="2990.731">200 OK</text><polygon fill="#A80036" points="916.5,3020.9297,906.5,3024.9297,916.5,3028.9297,912.5,3024.9297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="910.5" x2="1506.5" y1="3024.9297" y2="3024.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="922.5" y="3019.8638">INIT-30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="976.5" y="3019.8638">authorizationRequestReceived()</text><rect fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="242" x="910" y="3067.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234" x="914" y="3083.9966">state: authorizationRequestReceived</text><rect fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="228" x="910" y="3101.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="914" y="3117.1294">state: transactionInitiationSuccess</text><polygon fill="#A80036" points="568.5,3146.3281,558.5,3150.3281,568.5,3154.3281,564.5,3150.3281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="562.5" x2="899.5" y1="3150.3281" y2="3150.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="574.5" y="3145.2622">INIT-31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="628.5" y="3145.2622">QuoteInformation, transactionId</text><polygon fill="#A80036" points="85.5,3175.4609,75.5,3179.4609,85.5,3183.4609,81.5,3179.4609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79.5" x2="551.5" y1="3179.4609" y2="3179.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="91.5" y="3174.395">INIT-32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="145.5" y="3174.395">200 OK</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="170" x="2590.25" y="3211.6714">Present quote to be approved</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="142" x="2604.25" y="3224.4761">User signs the challenge</text><rect fill="#EEEEEE" filter="url(#f1au4b3xzil1e4)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="5310" x="0" y="3261.6367"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="5310" y1="3261.6367" y2="3261.6367"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="5310" y1="3264.6367" y2="3264.6367"/><rect fill="#EEEEEE" filter="url(#f1au4b3xzil1e4)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="171" x="2569.5" y="3251.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="152" x="2575.5" y="3267.1372">Approve Transaction</text><rect fill="#ADD8E6" filter="url(#f1au4b3xzil1e4)" height="83" style="stroke:#A80036;stroke-width:1.0;" width="404" x="79" y="3289.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="83" y="3305.27">rnote right of PISP #Light</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="396" x="83" y="3320.4028">POST /thirdpartyTransactions/{transactionRequestId}/approve</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="83" y="3335.5356">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="91" y="3350.6685">signedChallenge: "base64(xxx)"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="83" y="3365.8013">}</text><polygon fill="#A80036" points="535.5,3395,545.5,3399,535.5,3403,539.5,3399" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="79.5" x2="541.5" y1="3399" y2="3399"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="86.5" y="3393.9341">APPR-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="396" x="144.5" y="3393.9341">POST /thirdpartyTransactions/{transactionRequestId}/approve</text><polygon fill="#A80036" points="883.5,3424.1328,893.5,3428.1328,883.5,3432.1328,887.5,3428.1328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="557.5" x2="889.5" y1="3428.1328" y2="3428.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="564.5" y="3423.0669">APPR-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="622.5" y="3423.0669">approve()</text><rect fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="161" x="910" y="3441.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="914" y="3457.1997">state: approvalReceived</text><line style="stroke:#A80036;stroke-width:1.0;" x1="905.5" x2="947.5" y1="3490.3984" y2="3490.3984"/><line style="stroke:#A80036;stroke-width:1.0;" x1="947.5" x2="947.5" y1="3490.3984" y2="3503.3984"/><line style="stroke:#A80036;stroke-width:1.0;" x1="906.5" x2="947.5" y1="3503.3984" y2="3503.3984"/><polygon fill="#A80036" points="916.5,3499.3984,906.5,3503.3984,916.5,3507.3984,912.5,3503.3984" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="912.5" y="3485.3325">APPR-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="530" x="970.5" y="3485.3325">SDKRequests.requestVerifyAuthorization(authorizationRequestId, signedChallenge)</text><polygon fill="#A80036" points="2068,3528.5313,2078,3532.5313,2068,3536.5313,2072,3532.5313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="905.5" x2="2074" y1="3532.5313" y2="3532.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="912.5" y="3527.4653">APPR-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="416" x="970.5" y="3527.4653">PUT /thirdpartyRequests/authorizations/{authorizationRequestId}</text><polygon fill="#A80036" points="911.5,3557.6641,901.5,3561.6641,911.5,3565.6641,907.5,3561.6641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="905.5" x2="2079" y1="3561.6641" y2="3561.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="917.5" y="3556.5981">APPR-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="975.5" y="3556.5981">202 Accepted</text><rect fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="221" x="905" y="3574.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="909" y="3590.731">state: pendingVerifyAuthorization</text><polygon fill="#A80036" points="3561.5,3619.9297,3571.5,3623.9297,3561.5,3627.9297,3565.5,3623.9297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2090" x2="3567.5" y1="3623.9297" y2="3623.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="2097" y="3618.8638">APPR-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="416" x="2155" y="3618.8638">PUT /thirdpartyRequests/authorizations/{authorizationRequestId}</text><polygon fill="#A80036" points="2096,3649.0625,2086,3653.0625,2096,3657.0625,2092,3653.0625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2090" x2="3572.5" y1="3653.0625" y2="3653.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="2102" y="3647.9966">APPR-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2160" y="3647.9966">202 Accepted</text><polygon fill="#A80036" points="3868.5,3678.1953,3878.5,3682.1953,3868.5,3686.1953,3872.5,3682.1953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3583.5" x2="3874.5" y1="3682.1953" y2="3682.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="3590.5" y="3677.1294">APPR-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190" x="3648.5" y="3677.1294">200: AuthorizationInformation</text><path d="M3725,3695.1953 L3725,3720.1953 L4041,3720.1953 L4041,3705.1953 L4031,3695.1953 L3725,3695.1953 " fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4031,3695.1953 L4031,3705.1953 L4041,3705.1953 L4031,3695.1953 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="295" x="3731" y="3712.2622">From now DFSPTransactionModel is unblocked</text><path d="M3600,3734.3281 L3600,3759.3281 L4167,3759.3281 L4167,3744.3281 L4157,3734.3281 L3600,3734.3281 " fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4157,3734.3281 L4157,3744.3281 L4167,3744.3281 L4157,3734.3281 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="546" x="3606" y="3751.395">TransactionModel checks the received AuthorizationInformation with the auth-service.</text><rect fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="221" x="3895" y="3773.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="3899" y="3789.5278">state: pendingVerifyAuthorization</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3890.5" x2="3932.5" y1="3822.7266" y2="3822.7266"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3932.5" x2="3932.5" y1="3822.7266" y2="3835.7266"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3891.5" x2="3932.5" y1="3835.7266" y2="3835.7266"/><polygon fill="#A80036" points="3901.5,3831.7266,3891.5,3835.7266,3901.5,3839.7266,3897.5,3835.7266" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="3897.5" y="3817.6606">APPR-9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="3955.5" y="3817.6606">generate verificationRequestId</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3890.5" x2="3932.5" y1="3864.8594" y2="3864.8594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3932.5" x2="3932.5" y1="3864.8594" y2="3877.8594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3891.5" x2="3932.5" y1="3877.8594" y2="3877.8594"/><polygon fill="#A80036" points="3901.5,3873.8594,3891.5,3877.8594,3901.5,3881.8594,3897.5,3877.8594" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3897.5" y="3859.7935">APPR-10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="414" x="3964.5" y="3859.7935">ThirdpartyRequests.verifyAuthorization(AuthorizationInformation)</text><polygon fill="#A80036" points="2101,3902.9922,2091,3906.9922,2101,3910.9922,2097,3906.9922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2095" x2="3879.5" y1="3906.9922" y2="3906.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2107" y="3901.9263">APPR-11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243" x="2174" y="3901.9263">POST /thirdpartyRequests/verifications</text><polygon fill="#A80036" points="3868.5,3932.125,3878.5,3936.125,3868.5,3940.125,3872.5,3936.125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2090" x2="3874.5" y1="3936.125" y2="3936.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2097" y="3931.0591">APPR-12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2164" y="3931.0591">202 Accepted</text><polygon fill="#A80036" points="2585,3961.2578,2595,3965.2578,2585,3969.2578,2589,3965.2578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2090" x2="2591" y1="3965.2578" y2="3965.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2097" y="3960.1919">APPR-13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243" x="2164" y="3960.1919">POST /thirdpartyRequests/verifications</text><polygon fill="#A80036" points="2096,3990.3906,2086,3994.3906,2096,3998.3906,2092,3994.3906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2090" x2="2596" y1="3994.3906" y2="3994.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2102" y="3989.3247">APPR-14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2169" y="3989.3247">202 Accepted</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2607" x2="2649" y1="4023.5234" y2="4023.5234"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2649" x2="2649" y1="4023.5234" y2="4036.5234"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2608" x2="2649" y1="4036.5234" y2="4036.5234"/><polygon fill="#A80036" points="2618,4032.5234,2608,4036.5234,2618,4040.5234,2614,4036.5234" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2614" y="4018.4575">APPR-15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244" x="2681" y="4018.4575">Lookup Consent for payload.consentId</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2607" x2="2649" y1="4065.6563" y2="4065.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2649" x2="2649" y1="4065.6563" y2="4078.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2608" x2="2649" y1="4078.6563" y2="4078.6563"/><polygon fill="#A80036" points="2618,4074.6563,2608,4078.6563,2618,4082.6563,2614,4078.6563" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2614" y="4060.5903">APPR-16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="2681" y="4060.5903">Verify verification</text><path d="M5,4091.6563 L5,4116.6563 L3956,4116.6563 L3956,4101.6563 L3946,4091.6563 L5,4091.6563 " fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3946,4091.6563 L3946,4101.6563 L3956,4101.6563 L3946,4091.6563 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="680" x="1634.25" y="4108.7231">ERROR_SCENARIO: Challenge was signed by wrong private key, AuthService rejects the Verification request</text><polygon fill="#A80036" points="2101,4142.9219,2091,4146.9219,2101,4150.9219,2097,4146.9219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2095" x2="2596" y1="4146.9219" y2="4146.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2107" y="4141.856">APPR-17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="421" x="2174" y="4141.856">PUT /thirdpartyRequests/verifications/{verificationRequestId}/error</text><polygon fill="#A80036" points="2585,4172.0547,2595,4176.0547,2585,4180.0547,2589,4176.0547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2090" x2="2591" y1="4176.0547" y2="4176.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2097" y="4170.9888">APPR-18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="2164" y="4170.9888">200 OK</text><polygon fill="#A80036" points="3561.5,4201.1875,3571.5,4205.1875,3561.5,4209.1875,3565.5,4205.1875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2090" x2="3567.5" y1="4205.1875" y2="4205.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2097" y="4200.1216">APPR-19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="421" x="2164" y="4200.1216">PUT /thirdpartyRequests/verifications/{verificationRequestId}/error</text><polygon fill="#A80036" points="2096,4230.3203,2086,4234.3203,2096,4238.3203,2092,4234.3203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2090" x2="3572.5" y1="4234.3203" y2="4234.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2102" y="4229.2544">APPR-20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="2169" y="4229.2544">200 OK</text><polygon fill="#A80036" points="3868.5,4259.4531,3878.5,4263.4531,3868.5,4267.4531,3872.5,4263.4531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3583.5" x2="3874.5" y1="4263.4531" y2="4263.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3590.5" y="4258.3872">APPR-21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="3657.5" y="4258.3872">VerificationResponseInformation</text><rect fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="279" x="3895" y="4276.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="3899" y="4292.52">DFSP is unhappy with Authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="183" x="3899" y="4307.6528">transactionRequestState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10" x="4086" y="4307.6528">is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="70" x="4100" y="4307.6528">REJECTED</text><rect fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="209" x="3895" y="4324.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="3899" y="4340.7856">state: failureVerifyAuthorization</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3890.5" x2="3932.5" y1="4373.9844" y2="4373.9844"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3932.5" x2="3932.5" y1="4373.9844" y2="4386.9844"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3891.5" x2="3932.5" y1="4386.9844" y2="4386.9844"/><polygon fill="#A80036" points="3901.5,4382.9844,3891.5,4386.9844,3901.5,4390.9844,3897.5,4386.9844" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3897.5" y="4368.9185">APPR-22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="366" x="3964.5" y="4368.9185">persist transactionRequestState for transactionRequestId</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3890.5" x2="3932.5" y1="4416.1172" y2="4416.1172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3932.5" x2="3932.5" y1="4416.1172" y2="4429.1172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3891.5" x2="3932.5" y1="4429.1172" y2="4429.1172"/><polygon fill="#A80036" points="3901.5,4425.1172,3891.5,4429.1172,3901.5,4433.1172,3897.5,4429.1172" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3897.5" y="4411.0513">APPR-23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="512" x="3964.5" y="4411.0513">SDKRequests.notifyThirdpartyAboutRejectedAuthorization(transactionRequestId)</text><polygon fill="#A80036" points="2101,4454.25,2091,4458.25,2101,4462.25,2097,4458.25" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2095" x2="3879.5" y1="4458.25" y2="4458.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2107" y="4453.1841">APPR-24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="420" x="2174" y="4453.1841">PUT /thirdpartyRequests/transaction/{transactionRequestId}/error</text><polygon fill="#A80036" points="3868.5,4483.3828,3878.5,4487.3828,3868.5,4491.3828,3872.5,4487.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2090" x2="3874.5" y1="4487.3828" y2="4487.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2097" y="4482.3169">APPR-25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="2164" y="4482.3169">202 Accept</text><path d="M3640,4500.3828 L3640,4525.3828 L4127,4525.3828 L4127,4510.3828 L4117,4500.3828 L3640,4500.3828 " fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4117,4500.3828 L4117,4510.3828 L4127,4510.3828 L4117,4500.3828 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="3646" y="4517.4497">ERROR_SCENARIO:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="343" x="3769" y="4517.4497">DFSPTransactionModel ends its workflow here</text><polygon fill="#A80036" points="1528.5,4551.6484,1518.5,4555.6484,1528.5,4559.6484,1524.5,4555.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1522.5" x2="5275" y1="4555.6484" y2="4555.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1534.5" y="4550.5825">APPR-26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="420" x="1601.5" y="4550.5825">PUT /thirdpartyRequests/transaction/{transactionRequestId}/error</text><polygon fill="#A80036" points="2073,4580.7813,2083,4584.7813,2073,4588.7813,2077,4584.7813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1517.5" x2="2079" y1="4584.7813" y2="4584.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1524.5" y="4579.7153">APPR-27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="1591.5" y="4579.7153">202 Accept</text><path d="M647,4597.7813 L647,4622.7813 L1149,4622.7813 L1149,4607.7813 L1139,4597.7813 L647,4597.7813 " fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1139,4597.7813 L1139,4607.7813 L1149,4607.7813 L1139,4597.7813 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="653" y="4614.8481">ERROR_SCENARIO:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="358" x="776" y="4614.8481">PISPTransactionModel will end its workflow here</text><polygon fill="#A80036" points="916.5,4649.0469,906.5,4653.0469,916.5,4657.0469,912.5,4653.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="910.5" x2="1511.5" y1="4653.0469" y2="4653.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="922.5" y="4647.981">APPR-28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="989.5" y="4647.981">authorizationRejected()</text><rect fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="186" x="910" y="4666.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="914" y="4682.1138">state: rejectedAuthorization</text><polygon fill="#A80036" points="568.5,4711.3125,558.5,4715.3125,568.5,4719.3125,564.5,4715.3125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="562.5" x2="899.5" y1="4715.3125" y2="4715.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="574.5" y="4710.2466">APPR-29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="641.5" y="4710.2466">not approved: authorization is rejected</text><polygon fill="#A80036" points="90.5,4740.4453,80.5,4744.4453,90.5,4748.4453,86.5,4744.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="84.5" x2="546.5" y1="4744.4453" y2="4744.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="96.5" y="4739.3794">APPR-30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="163.5" y="4739.3794">500: authorization is rejected</text><path d="M5,4757.4453 L5,4782.4453 L3956,4782.4453 L3956,4767.4453 L3946,4757.4453 L5,4757.4453 " fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3946,4757.4453 L3946,4767.4453 L3956,4767.4453 L3946,4757.4453 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="1754.25" y="4774.5122">HAPPY_SCENARIO:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="317" x="1877.25" y="4774.5122">DFSPTransactionModel continues workflow</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2607" x2="2649" y1="4812.7109" y2="4812.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2649" x2="2649" y1="4812.7109" y2="4825.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2608" x2="2649" y1="4825.7109" y2="4825.7109"/><polygon fill="#A80036" points="2618,4821.7109,2608,4825.7109,2618,4829.7109,2614,4825.7109" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2614" y="4807.645">APPR-31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="399" x="2681" y="4807.645">Authorization is valid, challenge signed with correct private key</text><polygon fill="#A80036" points="2101,4850.8438,2091,4854.8438,2101,4858.8438,2097,4854.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2095" x2="2596" y1="4854.8438" y2="4854.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2107" y="4849.7778">APPR-32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="386" x="2174" y="4849.7778">PUT /thirdpartyRequests/verifications/{verificationRequestId}</text><polygon fill="#A80036" points="2585,4879.9766,2595,4883.9766,2585,4887.9766,2589,4883.9766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2090" x2="2591" y1="4883.9766" y2="4883.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2097" y="4878.9106">APPR-33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="2164" y="4878.9106">200 OK</text><polygon fill="#A80036" points="3561.5,4909.1094,3571.5,4913.1094,3561.5,4917.1094,3565.5,4913.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2090" x2="3567.5" y1="4913.1094" y2="4913.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2097" y="4908.0435">APPR-34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="386" x="2164" y="4908.0435">PUT /thirdpartyRequests/verifications/{verificationRequestId}</text><polygon fill="#A80036" points="2096,4938.2422,2086,4942.2422,2096,4946.2422,2092,4942.2422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2090" x2="3572.5" y1="4942.2422" y2="4942.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2102" y="4937.1763">APPR-35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="2169" y="4937.1763">200 OK</text><polygon fill="#A80036" points="3868.5,4967.375,3878.5,4971.375,3868.5,4975.375,3872.5,4971.375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3583.5" x2="3874.5" y1="4971.375" y2="4971.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3590.5" y="4966.3091">APPR-36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="3657.5" y="4966.3091">VerificationResponseInformation</text><rect fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="291" x="3895" y="4984.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="283" x="3899" y="5000.4419">The Auth Service is happy with Authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="183" x="3899" y="5015.5747">transactionRequestState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10" x="4086" y="5015.5747">is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="77" x="4100" y="5015.5747">ACCEPTED</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3890.5" x2="3932.5" y1="5048.7734" y2="5048.7734"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3932.5" x2="3932.5" y1="5048.7734" y2="5061.7734"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3891.5" x2="3932.5" y1="5061.7734" y2="5061.7734"/><polygon fill="#A80036" points="3901.5,5057.7734,3891.5,5061.7734,3901.5,5065.7734,3897.5,5061.7734" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3897.5" y="5043.7075">APPR-37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="366" x="3964.5" y="5043.7075">persist transactionRequestState for transactionRequestId</text><path d="M3705,5074.7734 L3705,5099.7734 L4061,5099.7734 L4061,5084.7734 L4051,5074.7734 L3705,5074.7734 " fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4051,5074.7734 L4051,5084.7734 L4061,5084.7734 L4051,5074.7734 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="335" x="3711" y="5091.8403">DFSP is happy, so initiates the Transfer for transferId</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3890.5" x2="3932.5" y1="5130.0391" y2="5130.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3932.5" x2="3932.5" y1="5130.0391" y2="5143.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3891.5" x2="3932.5" y1="5143.0391" y2="5143.0391"/><polygon fill="#A80036" points="3901.5,5139.0391,3891.5,5143.0391,3901.5,5147.0391,3897.5,5143.0391" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3897.5" y="5124.9731">APPR-38</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="3964.5" y="5124.9731">generate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="73" x="4026.5" y="5124.9731">transferId</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3890.5" x2="3932.5" y1="5172.1719" y2="5172.1719"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3932.5" x2="3932.5" y1="5172.1719" y2="5185.1719"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3891.5" x2="3932.5" y1="5185.1719" y2="5185.1719"/><polygon fill="#A80036" points="3901.5,5181.1719,3891.5,5185.1719,3901.5,5189.1719,3897.5,5185.1719" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3897.5" y="5167.106">APPR-39</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="3964.5" y="5167.106">transfer(transferId)</text><rect fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="152" x="3895" y="5198.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="3899" y="5214.2388">state: pendingTransfer</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3890.5" x2="3932.5" y1="5247.4375" y2="5247.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3932.5" x2="3932.5" y1="5247.4375" y2="5260.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3891.5" x2="3932.5" y1="5260.4375" y2="5260.4375"/><polygon fill="#A80036" points="3901.5,5256.4375,3891.5,5260.4375,3901.5,5264.4375,3897.5,5260.4375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3897.5" y="5242.3716">APPR-40</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="370" x="3964.5" y="5242.3716">SDKRequests.requestTransfer(transferId, transferPayload)</text><polygon fill="#A80036" points="3246.5,5285.5703,3236.5,5289.5703,3246.5,5293.5703,3242.5,5289.5703" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3240.5" x2="3879.5" y1="5289.5703" y2="5289.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3252.5" y="5284.5044">APPR-41</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="3319.5" y="5284.5044">SYNC POST /simpleTransfer</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3235.5" x2="3277.5" y1="5318.7031" y2="5318.7031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3277.5" x2="3277.5" y1="5318.7031" y2="5331.7031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3236.5" x2="3277.5" y1="5331.7031" y2="5331.7031"/><polygon fill="#A80036" points="3246.5,5327.7031,3236.5,5331.7031,3246.5,5335.7031,3242.5,5331.7031" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3242.5" y="5313.6372">APPR-42</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="257" x="3309.5" y="5313.6372">request Switch to realize simple transfer</text><polygon fill="#A80036" points="3868.5,5356.8359,3878.5,5360.8359,3868.5,5364.8359,3872.5,5360.8359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3230.5" x2="3874.5" y1="5360.8359" y2="5360.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3237.5" y="5355.77">APPR-43</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="3304.5" y="5355.77">202: Transfer done</text><path d="M3747,5373.8359 L3747,5398.8359 L4020,5398.8359 L4020,5383.8359 L4010,5373.8359 L3747,5373.8359 " fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4010,5373.8359 L4010,5383.8359 L4020,5383.8359 L4010,5373.8359 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="252" x="3753" y="5390.9028">DFSP notifies PISP that Transfer is done</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3890.5" x2="3932.5" y1="5429.1016" y2="5429.1016"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3932.5" x2="3932.5" y1="5429.1016" y2="5442.1016"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3891.5" x2="3932.5" y1="5442.1016" y2="5442.1016"/><polygon fill="#A80036" points="3901.5,5438.1016,3891.5,5442.1016,3901.5,5446.1016,3897.5,5442.1016" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3897.5" y="5424.0356">APPR-44</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="350" x="3964.5" y="5424.0356">SDKRequests.notifyThirdpartyAboutTransfer(transferId)</text><rect fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="291" x="3895" y="5455.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="283" x="3899" y="5471.1685">state: pendingNotifyThirdpartyAboutTransfer</text><polygon fill="#A80036" points="2101,5500.3672,2091,5504.3672,2101,5508.3672,2097,5504.3672" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2095" x2="3879.5" y1="5504.3672" y2="5504.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2107" y="5499.3013">APPR-45</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="410" x="2174" y="5499.3013">PATCH /thirdpartyRequests/transactions/{transactionRequestId}</text><polygon fill="#A80036" points="3873.5,5529.5,3883.5,5533.5,3873.5,5537.5,3877.5,5533.5" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2090" x2="3879.5" y1="5533.5" y2="5533.5"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2097" y="5528.4341">APPR-46</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2164" y="5528.4341">202 Accepted</text><rect fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="226" x="3890" y="5546.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="3894" y="5562.5669">state: transactionRequestSuccess</text><path d="M671,5579.6328 L671,5604.6328 L1126,5604.6328 L1126,5589.6328 L1116,5579.6328 L671,5579.6328 " fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1116,5579.6328 L1116,5589.6328 L1126,5589.6328 L1116,5579.6328 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="677" y="5596.6997">HAPPY_SCENARIO:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="311" x="800" y="5596.6997">PISPTransactionModel continues workflow</text><polygon fill="#A80036" points="1528.5,5630.8984,1518.5,5634.8984,1528.5,5638.8984,1524.5,5634.8984" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1522.5" x2="2079" y1="5634.8984" y2="5634.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1534.5" y="5629.8325">APPR-47</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="410" x="1601.5" y="5629.8325">PATCH /thirdpartyRequests/transactions/{transactionRequestId}</text><polygon fill="#A80036" points="2073,5660.0313,2083,5664.0313,2073,5668.0313,2077,5664.0313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1517.5" x2="2079" y1="5664.0313" y2="5664.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1524.5" y="5658.9653">APPR-48</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1591.5" y="5658.9653">200 OK</text><polygon fill="#A80036" points="916.5,5689.1641,906.5,5693.1641,916.5,5697.1641,912.5,5693.1641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="910.5" x2="1511.5" y1="5693.1641" y2="5693.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="922.5" y="5688.0981">APPR-49</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="270" x="989.5" y="5688.0981">transactionSuccess(transactionRequestId)</text><rect fill="#FBFB77" filter="url(#f1au4b3xzil1e4)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="174" x="910" y="5706.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="914" y="5722.231">state: transactionSuccess</text><polygon fill="#A80036" points="568.5,5751.4297,558.5,5755.4297,568.5,5759.4297,564.5,5755.4297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="562.5" x2="899.5" y1="5755.4297" y2="5755.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="574.5" y="5750.3638">APPR-50</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="641.5" y="5750.3638">Transaction &amp; Transfer are done</text><polygon fill="#A80036" points="85.5,5780.5625,75.5,5784.5625,85.5,5788.5625,81.5,5784.5625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79.5" x2="551.5" y1="5784.5625" y2="5784.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="91.5" y="5779.4966">APPR-51</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="158.5" y="5779.4966">200 OK</text><!--MD5=[4a23d3e4ae1487abf6d34b65e955dd50]
@startuml

title PISP Transaction


participant "PISP Backend" as PISP
box "PISP tp-scheme-adapter"
  participant "outbound-server" as PISP_TP_OUT
  participant "PISPTransactionModel" as PISP_TM
  participant "inbound-server" as PISP_TP_IN
end box
box "PISP sdk-scheme-adapter"
  participant "outbound-server" as PISP_SDK_OUT
  participant "inbound-server" as PISP_SDK_IN
end box
box "Mojaloop"
    participant Switch
    participant AuthService
end box
box "DFSP sdk-scheme-adapter"
  participant "inbound-server" as DFSP_SDK_IN
  participant "outbound-server" as DFSP_SDK_OUT
end box
box "DFSP tp-scheme-adapter"
  participant "inbound-server" as DFSP_TP_IN
  participant "DFSPTransactionModel" as DFSP_TM
  participant "outbound-server" as DFSP_TP_OUT
end box


== Party Lookup ==
autonumber 1 "<b>LOOK-#</b>"
rnote right of PISP #LightBlue
POST /thirdpartyTransaction/partyLookup
{
  transactionRequestId: "b51ec534-ee48-4575-b6a9-ead2955b8069",
  payee: {
    partyIdType: "MSISDN",
    partyIdentifier: "+123456789"
  }
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransaction/partyLookup
activate PISP
activate PISP_TP_OUT
' TODO: line up with state-models.md doc
PISP_TP_OUT -> PISP_TM: partyLookup()
rnote right of PISP_TM: state: requestPartyLookup
activate PISP_TM
PISP_TM -> PISP_TM: SDKRequests.requestPartiesInformation
PISP_TM -> PISP_SDK_OUT: SYNC GET /parties/{type}/{id}
activate PISP_SDK_OUT
PISP_SDK_OUT -> PISP_SDK_OUT: retrieve PartiesInformation from Switch
PISP_SDK_OUT -> PISP_TM: 200 PartyInformation
deactivate PISP_SDK_OUT
rnote right of PISP_TM: state: payeeResolved

PISP_TM -> PISP_TP_OUT: partyInformation
deactivate PISP_TM

' TODO: party lookup details
PISP_TP_OUT - -> PISP: 200 OK PartyInformation
deactivate PISP_TP_OUT
deactivate PISP

...User checks the party name, and confirms transaction to continue...



== Initate Transaction ==
autonumber 1 "<b>INIT-#</b>"
rnote right of PISP #LightBlue
POST /thirdpartyTransactions/{transactionRequestId}/initiate
{
  amount: {
    amount: "20.00",
    currency: "USD"
  },
  "amountType": "SEND",
  "payee": {....},
  "payer": {
    "partyIdType": "THIRD_PARTY_LINK",
    "partyIdentifier": "qwerty-56789",
    "fspId": "dfspa"
  },
  "transactionType": {
    "scenario": "TRANSFER",
    "initiator": 'PAYER",
    "initiatorType": "CONSUMER"
  },
  expiration: "2021-03-08T08:08:08.699-04:00"
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransactions/{transactionRequestId}/initiate
activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TM: initiate()
activate PISP_TM
rnote right of PISP_TM: state: requestThirdpartyTransaction
PISP_TM -> PISP_TM: SDKRequests.requestThirdpartyTransaction()
PISP_TM -> Switch: POST /thirdpartyRequests/transactions
activate Switch
Switch - -> PISP_TM: 202 Accepted
deactivate PISP_TM
rnote right of PISP_TM: state: pendingTransactionInitiation

note over DFSP_TP_IN
  DFSP handles PISP transaction request
end note
Switch -> DFSP_TP_IN: POST /thirdpartyRequests/transactions
activate DFSP_TP_IN
DFSP_TP_IN - -> Switch: 202 Accepted
deactivate Switch
note over DFSP_TM
  DFSP starts workflow for DFSPTransactionModel
end note
DFSP_TP_IN -> DFSP_TM: transactionRequestReceived()
deactivate DFSP_TP_IN
activate DFSP_TM
rnote right of DFSP_TM: state: transactionRequestReceived\n**transactionRequestState** is **RECEIVED**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
note over DFSP_TM
  DFSP asks its backend to verify consent for payer via THIRD_PARTY_LINK
end note
DFSP_TM -> DFSP_TM: DFSPBackendRequests.validateThirdpartyTransactionRequestAndGetContext(transactionRequest)
note over DFSP_TM
  DFSP is happy with Consent
end note
rnote right of DFSP_TM: state: consentIsValid
DFSP_TM -> DFSP_TM: so generate **transactionId**: '1234-1234-1234-1234'
note over DFSP_TM
  DFSP informs PISP that **transactionId** has been allocated
end note
DFSP_TM -> DFSP_TM: SDKRequests.notifyThirdpartyAboutTransactionRequestState(transactionId, transactionRequestState)
rnote right of DFSP_TM: state: pendingNotifyThirdpartyAboutTransactionRequestState
rnote right of DFSP_TM #LightBlue
PUT /thirdpartyRequests/transaction/{transactionRequestId}
{
  transactionId: '1234-1234-1234-1234',
  transactionRequestState: 'RECEIVED'
}
end note
DFSP_TM -> Switch: PUT /thirdpartyRequests/transaction/{transactionRequestId}
activate Switch
Switch - -> DFSP_TM: 202 Accepted
Switch -> PISP_TP_IN: PUT /thirdpartyRequests/transaction/{transactionRequestId}
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 202 accepted
deactivate Switch
PISP_TP_IN -> PISP_TM: transactionRequestReceived()
activate PISP_TM
rnote right of PISP_TM: state: transactionRequestReceived
PISP_TM -> PISP_TM: store received **transactionId**
deactivate PISP_TM
deactivate PISP_TP_IN
note over PISP_TM
  There could be a race condition (time based hazard)
  between two incoming calls 
  
  **PUT /thirdpartyReqeusts/transaction/{id}**
  and
  **POST /thirdpartyRequests/authorizations**
  
  so we are mitigating it by alternative two-step transitions:

  pendingTransactionInitiation (START): 
    -> (CASE-1) transactionRequestReceived -> authorizationRequestReceived
    -> (CASE-2) authorizationRequestReceived -> transactionRequestReceived
  -> transactionInitiationSuccess (END)

  CASE-1 is visualised here
end note

note over DFSP_TM
  DFSP requires QuoteInformation
end note
DFSP_TM -> DFSP_TM: SDKRequests.requestQuote()
rnote right of DFSP_TM: state: pendingRequestQuote
DFSP_TM -> DFSP_SDK_OUT: SYNC POST /quotes
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_SDK_OUT: retrieve QuoteInformation from Switch
DFSP_SDK_OUT -> DFSP_TM: 200 QuoteInformation
deactivate DFSP_SDK_OUT
note over DFSP_TM
  DFSP has the QuoteInformation, they can now ask the PISP for authorization
end note
DFSP_TM -> DFSP_TM: SDKRequests.requestAuthorization()
rnote right of DFSP_TM: state: pendingRequestAuthorization\n**transactionRequestState** is **PENDING**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
DFSP_TM -> Switch: POST /thirdpartyRequests/authorizations
activate Switch
note over DFSP_TM
  From now DFSPTransactionModel is blocked
  on synchronous call to POST /thirdpartyRequests/authorizations
  until PISP initiate **Approve Transaction** phase.
  Here timeout scenario should be handled properly
end note
Switch - -> DFSP_TM: 202 Accepted
activate -> activate: waiting on PUT /thirdpartyRequests/authorizations/{authorizationRequestId}
deactivate activate
Switch -> PISP_TP_IN: POST /thirdpartyRequests/authorizations
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch
PISP_TP_IN -> PISP_TM: authorizationRequestReceived()
rnote right of PISP_TM: state: authorizationRequestReceived
activate PISP_TM

rnote right of PISP_TM: state: transactionInitiationSuccess

deactivate PISP_TP_IN


PISP_TM -> PISP_TP_OUT: QuoteInformation, transactionId
deactivate PISP_TM
deactivate PISP_TP_IN

PISP_TP_OUT - -> PISP: 200 OK
deactivate PISP_TP_OUT
deactivate PISP

...Present quote to be approved\nUser signs the challenge...


== Approve Transaction ==
autonumber 1 "<b>APPR-#</b>"
rnote right of PISP #LightBlue
rnote right of PISP #Light
POST /thirdpartyTransactions/{transactionRequestId}/approve
{
  signedChallenge: "base64(xxx)"
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransactions/{transactionRequestId}/approve
activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TM: approve()
activate PISP_TM
rnote right of PISP_TM: state: approvalReceived
PISP_TM -> PISP_TM: SDKRequests.requestVerifyAuthorization(authorizationRequestId, signedChallenge)

PISP_TM -> Switch: PUT /thirdpartyRequests/authorizations/{authorizationRequestId}
activate Switch
Switch - -> PISP_TM: 202 Accepted
rnote right of PISP_TM: state: pendingVerifyAuthorization
deactivate PISP_TM
Switch -> DFSP_TP_IN: PUT /thirdpartyRequests/authorizations/{authorizationRequestId}
activate DFSP_TP_IN
DFSP_TP_IN - -> Switch: 202 Accepted
deactivate Switch
DFSP_TP_IN -> DFSP_TM: 200: AuthorizationInformation
note over DFSP_TM
  From now DFSPTransactionModel is unblocked
end note
note over DFSP_TM
  TransactionModel checks the received AuthorizationInformation with the auth-service.
end note
rnote right of DFSP_TM: state: pendingVerifyAuthorization
DFSP_TM -> DFSP_TM: generate verificationRequestId

DFSP_TM -> DFSP_TM: ThirdpartyRequests.verifyAuthorization(AuthorizationInformation)

DFSP_TM -> Switch: POST /thirdpartyRequests/verifications
activate Switch
Switch - -> DFSP_TM: 202 Accepted

Switch -> AuthService: POST /thirdpartyRequests/verifications
activate AuthService
AuthService - -> Switch: 202 Accepted
deactivate Switch

AuthService -> AuthService: Lookup Consent for payload.consentId
AuthService -> AuthService: Verify verification

note over PISP, DFSP_TM
  ERROR_SCENARIO: Challenge was signed by wrong private key, AuthService rejects the Verification request
end note

AuthService -> Switch: PUT /thirdpartyRequests/verifications/{verificationRequestId}/error
activate Switch
Switch - -> AuthService: 200 OK
Switch -> DFSP_TP_IN: PUT /thirdpartyRequests/verifications/{verificationRequestId}/error
DFSP_TP_IN - -> Switch: 200 OK
deactivate Switch

DFSP_TP_IN -> DFSP_TM: VerificationResponseInformation

rnote right of DFSP_TM: DFSP is unhappy with Authorization\n**transactionRequestState** is **REJECTED**
rnote right of DFSP_TM: state: failureVerifyAuthorization
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
DFSP_TM -> DFSP_TM: SDKRequests.notifyThirdpartyAboutRejectedAuthorization(transactionRequestId)
DFSP_TM -> Switch: PUT /thirdpartyRequests/transaction/{transactionRequestId}/error
activate Switch
Switch -> DFSP_TM: 202 Accept
note over DFSP_TM
  ERROR_SCENARIO: **DFSPTransactionModel ends its workflow here**
end note
Swich -> PISP_TP_IN: PUT /thirdpartyRequests/transaction/{transactionRequestId}/error
activate PISP_TP_IN
PISP_TP_IN -> Switch: 202 Accept
deactivate Switch

note over PISP_TM
  ERROR_SCENARIO: **PISPTransactionModel will end its workflow here**
end note
PISP_TP_IN -> PISP_TM: authorizationRejected()
deactivate PISP_TP_IN
activate PISP_TM
rnote right of PISP_TM: state: rejectedAuthorization
PISP_TM -> PISP_TP_OUT: not approved: authorization is rejected
deactivate PISP_TM
PISP_TP_OUT -> PISP: 500: authorization is rejected



note over PISP, DFSP_TM
  HAPPY_SCENARIO: **DFSPTransactionModel continues workflow**
end note

AuthService -> AuthService: Authorization is valid, challenge signed with correct private key

AuthService -> Switch: PUT /thirdpartyRequests/verifications/{verificationRequestId}
activate Switch
Switch - -> AuthService: 200 OK
Switch -> DFSP_TP_IN: PUT /thirdpartyRequests/verifications/{verificationRequestId}
DFSP_TP_IN - -> Switch: 200 OK
deactivate Switch

DFSP_TP_IN -> DFSP_TM: VerificationResponseInformation


rnote right of DFSP_TM: The Auth Service is happy with Authorization\n**transactionRequestState** is **ACCEPTED**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId

note over DFSP_TM
  DFSP is happy, so initiates the Transfer for transferId
end note
DFSP_TM -> DFSP_TM: generate **transferId**
DFSP_TM -> DFSP_TM: transfer(transferId)
rnote right of DFSP_TM: state: pendingTransfer
DFSP_TM -> DFSP_TM: SDKRequests.requestTransfer(transferId, transferPayload)
DFSP_TM -> DFSP_SDK_OUT: SYNC POST /simpleTransfer
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_SDK_OUT: request Switch to realize simple transfer
DFSP_SDK_OUT -> DFSP_TM: 202: Transfer done
deactivate DFSP_SDK_OUT
note over DFSP_TM
  DFSP notifies PISP that Transfer is done
end note
DFSP_TM -> DFSP_TM: SDKRequests.notifyThirdpartyAboutTransfer(transferId)
rnote right of DFSP_TM: state: pendingNotifyThirdpartyAboutTransfer

DFSP_TM -> Switch: PATCH /thirdpartyRequests/transactions/{transactionRequestId}
activate Switch
Switch - -> DFSP_TM: 202 Accepted
rnote right of DFSP_TM: state: transactionRequestSuccess
deactivate DFSP_TM


note over PISP_TM
  HAPPY_SCENARIO: **PISPTransactionModel continues workflow**
end note

Switch -> PISP_TP_IN: PATCH /thirdpartyRequests/transactions/{transactionRequestId}
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch

PISP_TP_IN -> PISP_TM: transactionSuccess(transactionRequestId)
deactivate PISP_TP_IN
activate PISP_TM
rnote right of PISP_TM: state: transactionSuccess


PISP_TM -> PISP_TP_OUT: Transaction & Transfer are done
deactivate PISP_TM

PISP_TP_OUT - -> PISP: 200 OK
deactivate PISP_TP_OUT
deactivate PISP

@enduml

@startuml

title PISP Transaction


participant "PISP Backend" as PISP
box "PISP tp-scheme-adapter"
  participant "outbound-server" as PISP_TP_OUT
  participant "PISPTransactionModel" as PISP_TM
  participant "inbound-server" as PISP_TP_IN
end box
box "PISP sdk-scheme-adapter"
  participant "outbound-server" as PISP_SDK_OUT
  participant "inbound-server" as PISP_SDK_IN
end box
box "Mojaloop"
    participant Switch
    participant AuthService
end box
box "DFSP sdk-scheme-adapter"
  participant "inbound-server" as DFSP_SDK_IN
  participant "outbound-server" as DFSP_SDK_OUT
end box
box "DFSP tp-scheme-adapter"
  participant "inbound-server" as DFSP_TP_IN
  participant "DFSPTransactionModel" as DFSP_TM
  participant "outbound-server" as DFSP_TP_OUT
end box


== Party Lookup ==
autonumber 1 "<b>LOOK-#</b>"
rnote right of PISP #LightBlue
POST /thirdpartyTransaction/partyLookup
{
  transactionRequestId: "b51ec534-ee48-4575-b6a9-ead2955b8069",
  payee: {
    partyIdType: "MSISDN",
    partyIdentifier: "+123456789"
  }
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransaction/partyLookup
activate PISP
activate PISP_TP_OUT
PISP_TP_OUT -> PISP_TM: partyLookup()
rnote right of PISP_TM: state: requestPartyLookup
activate PISP_TM
PISP_TM -> PISP_TM: SDKRequests.requestPartiesInformation
PISP_TM -> PISP_SDK_OUT: SYNC GET /parties/{type}/{id}
activate PISP_SDK_OUT
PISP_SDK_OUT -> PISP_SDK_OUT: retrieve PartiesInformation from Switch
PISP_SDK_OUT -> PISP_TM: 200 PartyInformation
deactivate PISP_SDK_OUT
rnote right of PISP_TM: state: payeeResolved

PISP_TM -> PISP_TP_OUT: partyInformation
deactivate PISP_TM

PISP_TP_OUT - -> PISP: 200 OK PartyInformation
deactivate PISP_TP_OUT
deactivate PISP

...User checks the party name, and confirms transaction to continue...



== Initate Transaction ==
autonumber 1 "<b>INIT-#</b>"
rnote right of PISP #LightBlue
POST /thirdpartyTransactions/{transactionRequestId}/initiate
{
  amount: {
    amount: "20.00",
    currency: "USD"
  },
  "amountType": "SEND",
  "payee": {....},
  "payer": {
    "partyIdType": "THIRD_PARTY_LINK",
    "partyIdentifier": "qwerty-56789",
    "fspId": "dfspa"
  },
  "transactionType": {
    "scenario": "TRANSFER",
    "initiator": 'PAYER",
    "initiatorType": "CONSUMER"
  },
  expiration: "2021-03-08T08:08:08.699-04:00"
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransactions/{transactionRequestId}/initiate
activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TM: initiate()
activate PISP_TM
rnote right of PISP_TM: state: requestThirdpartyTransaction
PISP_TM -> PISP_TM: SDKRequests.requestThirdpartyTransaction()
PISP_TM -> Switch: POST /thirdpartyRequests/transactions
activate Switch
Switch - -> PISP_TM: 202 Accepted
deactivate PISP_TM
rnote right of PISP_TM: state: pendingTransactionInitiation

note over DFSP_TP_IN
  DFSP handles PISP transaction request
end note
Switch -> DFSP_TP_IN: POST /thirdpartyRequests/transactions
activate DFSP_TP_IN
DFSP_TP_IN - -> Switch: 202 Accepted
deactivate Switch
note over DFSP_TM
  DFSP starts workflow for DFSPTransactionModel
end note
DFSP_TP_IN -> DFSP_TM: transactionRequestReceived()
deactivate DFSP_TP_IN
activate DFSP_TM
rnote right of DFSP_TM: state: transactionRequestReceived\n**transactionRequestState** is **RECEIVED**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
note over DFSP_TM
  DFSP asks its backend to verify consent for payer via THIRD_PARTY_LINK
end note
DFSP_TM -> DFSP_TM: DFSPBackendRequests.validateThirdpartyTransactionRequestAndGetContext(transactionRequest)
note over DFSP_TM
  DFSP is happy with Consent
end note
rnote right of DFSP_TM: state: consentIsValid
DFSP_TM -> DFSP_TM: so generate **transactionId**: '1234-1234-1234-1234'
note over DFSP_TM
  DFSP informs PISP that **transactionId** has been allocated
end note
DFSP_TM -> DFSP_TM: SDKRequests.notifyThirdpartyAboutTransactionRequestState(transactionId, transactionRequestState)
rnote right of DFSP_TM: state: pendingNotifyThirdpartyAboutTransactionRequestState
rnote right of DFSP_TM #LightBlue
PUT /thirdpartyRequests/transaction/{transactionRequestId}
{
  transactionId: '1234-1234-1234-1234',
  transactionRequestState: 'RECEIVED'
}
end note
DFSP_TM -> Switch: PUT /thirdpartyRequests/transaction/{transactionRequestId}
activate Switch
Switch - -> DFSP_TM: 202 Accepted
Switch -> PISP_TP_IN: PUT /thirdpartyRequests/transaction/{transactionRequestId}
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 202 accepted
deactivate Switch
PISP_TP_IN -> PISP_TM: transactionRequestReceived()
activate PISP_TM
rnote right of PISP_TM: state: transactionRequestReceived
PISP_TM -> PISP_TM: store received **transactionId**
deactivate PISP_TM
deactivate PISP_TP_IN
note over PISP_TM
  There could be a race condition (time based hazard)
  between two incoming calls 
  
  **PUT /thirdpartyReqeusts/transaction/{id}**
  and
  **POST /thirdpartyRequests/authorizations**
  
  so we are mitigating it by alternative two-step transitions:

  pendingTransactionInitiation (START): 
    -> (CASE-1) transactionRequestReceived -> authorizationRequestReceived
    -> (CASE-2) authorizationRequestReceived -> transactionRequestReceived
  -> transactionInitiationSuccess (END)

  CASE-1 is visualised here
end note

note over DFSP_TM
  DFSP requires QuoteInformation
end note
DFSP_TM -> DFSP_TM: SDKRequests.requestQuote()
rnote right of DFSP_TM: state: pendingRequestQuote
DFSP_TM -> DFSP_SDK_OUT: SYNC POST /quotes
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_SDK_OUT: retrieve QuoteInformation from Switch
DFSP_SDK_OUT -> DFSP_TM: 200 QuoteInformation
deactivate DFSP_SDK_OUT
note over DFSP_TM
  DFSP has the QuoteInformation, they can now ask the PISP for authorization
end note
DFSP_TM -> DFSP_TM: SDKRequests.requestAuthorization()
rnote right of DFSP_TM: state: pendingRequestAuthorization\n**transactionRequestState** is **PENDING**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
DFSP_TM -> Switch: POST /thirdpartyRequests/authorizations
activate Switch
note over DFSP_TM
  From now DFSPTransactionModel is blocked
  on synchronous call to POST /thirdpartyRequests/authorizations
  until PISP initiate **Approve Transaction** phase.
  Here timeout scenario should be handled properly
end note
Switch - -> DFSP_TM: 202 Accepted
activate -> activate: waiting on PUT /thirdpartyRequests/authorizations/{authorizationRequestId}
deactivate activate
Switch -> PISP_TP_IN: POST /thirdpartyRequests/authorizations
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch
PISP_TP_IN -> PISP_TM: authorizationRequestReceived()
rnote right of PISP_TM: state: authorizationRequestReceived
activate PISP_TM

rnote right of PISP_TM: state: transactionInitiationSuccess

deactivate PISP_TP_IN


PISP_TM -> PISP_TP_OUT: QuoteInformation, transactionId
deactivate PISP_TM
deactivate PISP_TP_IN

PISP_TP_OUT - -> PISP: 200 OK
deactivate PISP_TP_OUT
deactivate PISP

...Present quote to be approved\nUser signs the challenge...


== Approve Transaction ==
autonumber 1 "<b>APPR-#</b>"
rnote right of PISP #LightBlue
rnote right of PISP #Light
POST /thirdpartyTransactions/{transactionRequestId}/approve
{
  signedChallenge: "base64(xxx)"
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransactions/{transactionRequestId}/approve
activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TM: approve()
activate PISP_TM
rnote right of PISP_TM: state: approvalReceived
PISP_TM -> PISP_TM: SDKRequests.requestVerifyAuthorization(authorizationRequestId, signedChallenge)

PISP_TM -> Switch: PUT /thirdpartyRequests/authorizations/{authorizationRequestId}
activate Switch
Switch - -> PISP_TM: 202 Accepted
rnote right of PISP_TM: state: pendingVerifyAuthorization
deactivate PISP_TM
Switch -> DFSP_TP_IN: PUT /thirdpartyRequests/authorizations/{authorizationRequestId}
activate DFSP_TP_IN
DFSP_TP_IN - -> Switch: 202 Accepted
deactivate Switch
DFSP_TP_IN -> DFSP_TM: 200: AuthorizationInformation
note over DFSP_TM
  From now DFSPTransactionModel is unblocked
end note
note over DFSP_TM
  TransactionModel checks the received AuthorizationInformation with the auth-service.
end note
rnote right of DFSP_TM: state: pendingVerifyAuthorization
DFSP_TM -> DFSP_TM: generate verificationRequestId

DFSP_TM -> DFSP_TM: ThirdpartyRequests.verifyAuthorization(AuthorizationInformation)

DFSP_TM -> Switch: POST /thirdpartyRequests/verifications
activate Switch
Switch - -> DFSP_TM: 202 Accepted

Switch -> AuthService: POST /thirdpartyRequests/verifications
activate AuthService
AuthService - -> Switch: 202 Accepted
deactivate Switch

AuthService -> AuthService: Lookup Consent for payload.consentId
AuthService -> AuthService: Verify verification

note over PISP, DFSP_TM
  ERROR_SCENARIO: Challenge was signed by wrong private key, AuthService rejects the Verification request
end note

AuthService -> Switch: PUT /thirdpartyRequests/verifications/{verificationRequestId}/error
activate Switch
Switch - -> AuthService: 200 OK
Switch -> DFSP_TP_IN: PUT /thirdpartyRequests/verifications/{verificationRequestId}/error
DFSP_TP_IN - -> Switch: 200 OK
deactivate Switch

DFSP_TP_IN -> DFSP_TM: VerificationResponseInformation

rnote right of DFSP_TM: DFSP is unhappy with Authorization\n**transactionRequestState** is **REJECTED**
rnote right of DFSP_TM: state: failureVerifyAuthorization
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
DFSP_TM -> DFSP_TM: SDKRequests.notifyThirdpartyAboutRejectedAuthorization(transactionRequestId)
DFSP_TM -> Switch: PUT /thirdpartyRequests/transaction/{transactionRequestId}/error
activate Switch
Switch -> DFSP_TM: 202 Accept
note over DFSP_TM
  ERROR_SCENARIO: **DFSPTransactionModel ends its workflow here**
end note
Swich -> PISP_TP_IN: PUT /thirdpartyRequests/transaction/{transactionRequestId}/error
activate PISP_TP_IN
PISP_TP_IN -> Switch: 202 Accept
deactivate Switch

note over PISP_TM
  ERROR_SCENARIO: **PISPTransactionModel will end its workflow here**
end note
PISP_TP_IN -> PISP_TM: authorizationRejected()
deactivate PISP_TP_IN
activate PISP_TM
rnote right of PISP_TM: state: rejectedAuthorization
PISP_TM -> PISP_TP_OUT: not approved: authorization is rejected
deactivate PISP_TM
PISP_TP_OUT -> PISP: 500: authorization is rejected



note over PISP, DFSP_TM
  HAPPY_SCENARIO: **DFSPTransactionModel continues workflow**
end note

AuthService -> AuthService: Authorization is valid, challenge signed with correct private key

AuthService -> Switch: PUT /thirdpartyRequests/verifications/{verificationRequestId}
activate Switch
Switch - -> AuthService: 200 OK
Switch -> DFSP_TP_IN: PUT /thirdpartyRequests/verifications/{verificationRequestId}
DFSP_TP_IN - -> Switch: 200 OK
deactivate Switch

DFSP_TP_IN -> DFSP_TM: VerificationResponseInformation


rnote right of DFSP_TM: The Auth Service is happy with Authorization\n**transactionRequestState** is **ACCEPTED**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId

note over DFSP_TM
  DFSP is happy, so initiates the Transfer for transferId
end note
DFSP_TM -> DFSP_TM: generate **transferId**
DFSP_TM -> DFSP_TM: transfer(transferId)
rnote right of DFSP_TM: state: pendingTransfer
DFSP_TM -> DFSP_TM: SDKRequests.requestTransfer(transferId, transferPayload)
DFSP_TM -> DFSP_SDK_OUT: SYNC POST /simpleTransfer
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_SDK_OUT: request Switch to realize simple transfer
DFSP_SDK_OUT -> DFSP_TM: 202: Transfer done
deactivate DFSP_SDK_OUT
note over DFSP_TM
  DFSP notifies PISP that Transfer is done
end note
DFSP_TM -> DFSP_TM: SDKRequests.notifyThirdpartyAboutTransfer(transferId)
rnote right of DFSP_TM: state: pendingNotifyThirdpartyAboutTransfer

DFSP_TM -> Switch: PATCH /thirdpartyRequests/transactions/{transactionRequestId}
activate Switch
Switch - -> DFSP_TM: 202 Accepted
rnote right of DFSP_TM: state: transactionRequestSuccess
deactivate DFSP_TM


note over PISP_TM
  HAPPY_SCENARIO: **PISPTransactionModel continues workflow**
end note

Switch -> PISP_TP_IN: PATCH /thirdpartyRequests/transactions/{transactionRequestId}
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch

PISP_TP_IN -> PISP_TM: transactionSuccess(transactionRequestId)
deactivate PISP_TP_IN
activate PISP_TM
rnote right of PISP_TM: state: transactionSuccess


PISP_TM -> PISP_TP_OUT: Transaction & Transfer are done
deactivate PISP_TM

PISP_TP_OUT - -> PISP: 200 OK
deactivate PISP_TP_OUT
deactivate PISP

@enduml

PlantUML version 1.2021.7(Sun May 23 22:10:07 ACST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>